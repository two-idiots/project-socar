/*
TouchSlider 0.95
Licensed under the MIT license.
http://touchslider.com
*/
/*jslint browser: true, undef: true, sloppy: true, vars: true, white: true, nomen: true, plusplus: true, maxerr: 50, indent: 4 */
/*global WebKitCSSMatrix: false, jQuery: false, getComputedStyle: false */
(function(a,b){window.touchSlider=function(f){f=f||{};var k=f.namespace||"touchslider",l=a(f.container);if(l.length!==1){l.each(function(){touchSlider({container:this})});return}f=a.extend({autoplay:false,delay:3000,margin:5,viewport:"."+k+"-viewport",prev:"."+k+"-prev",next:"."+k+"-next",pagination:"."+k+"-nav-item",currentClass:k+"-nav-item-current",duration:350,mouseTouch:true,startSlide:1},f);var C={current:0,step:h,next:o,prev:n,start:g,stop:s,startslide:r},c="ontouchstart" in window&&"WebKitCSSMatrix" in window,x="touchstart",m="touchmove",A="touchend",y=a(f.viewport,l),w=f.scroller?a(f.scroller,l):y.children(),q=w.children(),u=a(f.pagination,l);if(w.css("position")!=="absolute"){var e=y.height();y.css({height:e,position:"relative"});w.css({position:"absolute",left:0,height:e,width:100000})}if(!c){x="mousedown";m="mousemove";A="mouseup"}q.css("position","absolute");var B=c?function(F,E,G){if(E===b){return new WebKitCSSMatrix(getComputedStyle(F.jquery?F[0]:F).webkitTransform).e}F.css({webkitTransitionDuration:G?G+"ms":"0",webkitTransform:function(H){return"translate3d("+(typeof E==="number"?E:E.call(this,H))+"px,0,0)"}})}:function(F,E){if(E===b){return parseInt((F.jquery?F[0]:F).style.left,10)}F.css("left",E)};if(c){q.css({webkitTransitionProperty:"-webkit-transform",webkitTransitionTimingFunction:"cubic-bezier(0,0,0.25,1)"})}B(q.not(q[0]),10000);B(q.eq(0),0);var p=(function(){var F=[0],E=[0],G=a.noop;return{moving:false,init:function(){w.bind("webkitTransitionEnd",function(){G()})},to:function(M,H){H=H||{};if(M>=q.length){M=0}else{if(M<0){M=q.length-1}}var N=f.duration,J=q.eq(M),I=a.inArray(M,F),S=0;w.stop();p.moving=true;clearTimeout(j);if(I!==-1){S=E[I]}else{var O,L=q.index(J);I=b;if(H.dirX===-1){E.unshift(0);F.unshift(L)}else{if(H.dirX===1){E.push(0);F.push(L)}else{for(O=F.length-1;O>=0;O--){if(F[O]<L){E.splice(O+1,0,0);F.splice(O+1,0,L);I=0;break}}if(I===b){E.unshift(E);F.unshift(L)}}}I=a.inArray(L,F);if(I===0){S=E[1]-(J.outerWidth()+f.margin);B(J,S);E[I]=S}else{if(I===F.length-1){S=E[I-1]+q.eq(F[I-1]).outerWidth()+f.margin;B(J,S);E[I]=S}else{var R=J.outerWidth();J.css("opacity",0);S=E[I+1]-Math.round((R+f.margin)/2);E[I]=S;B(J,S);var Q=S,K=F.length;for(O=I-1;O>=0;O--){Q-=q.eq(F[O]).outerWidth()+f.margin;E[O]=Q}var P=S;for(O=I+1;O<K;O++){P+=q.eq(F[O]).outerWidth()+f.margin;E[O]=P}for(O=0;O<K;O++){q.eq(F[O]).animate({left:E[O]},{duration:N,queue:false,complete:function(){if(J.is(this)){J.animate({opacity:1},N)}}})}}}}if(H.pxInMs){N=Math.min(Math.max(Math.round(Math.abs(B(w))/H.pxInMs),100),N)}G=function(){B(q.not(J),-10000);F=[q.index(J)];E=[S];if(H.complete){H.complete()}p.moving=false;t()};if(!c){w.animate({left:-S},{duration:N,queue:false,complete:G})}else{B(w,-S,N)}C.current=M;i(M)},stop:function(){if(c){B(w,B(w))}else{w.stop()}},moveStart:function(J){p.moving=true;clearTimeout(j);w.stop();p.startPageX=J.pageX;var H=B(w),I;p.leftCount=H;if(F[0]===0){if(E[0]+H>0){p.leftCount=H+(E[0]+H)*3}}else{if(F[F.length-1]===q.length-1){I=E[F.length-1]+H;if(I<0){p.leftCount=H+I*3}}}},move:function(M,O){var N=M.pageX-O,K=B(w),I=q.eq(F[0]),J=F.length-1,P=q.eq(F[J]),Q,H,L;p.leftCount+=N;if(N>0){while(F[0]!==0&&K+E[0]+N>f.margin){Q=q.eq(F[0]-1);H=E[0]-Q.outerWidth()-f.margin;B(Q,H);E.unshift(H);F.unshift(F[0]-1);J++;I=Q}}if(((N>0&&K+E[0]+N>0)||(N<0&&K+E[0]>0))&&F[0]===0){L=Math.min(Math.round((p.leftCount+E[0])/4),y.innerWidth()/2);N=L-(K+E[0])}if(N<0){while(!P.is(q.last())&&K+E[J]+N+P.outerWidth()+f.margin<y.innerWidth()){Q=q.eq(F[J]+1);H=E[J]+P.outerWidth()+f.margin;B(Q,H);E.push(H);F.push(F[J++]+1);P=Q}}if(((N>0&&K+E[J]<0)||(N<0&&K+E[J]+N<0))&&P.is(q.last())){L=Math.max(Math.round((p.leftCount+E[J])/4),-y.innerWidth()/2);N=L-(K+E[J])}B(w,K+N)},moveEnd:function(P,W,V,J,S,R){var K=F.length,N=B(w),L=K-1,I;if(E[0]+N>0){L=0}else{if(E[F.length-1]+N<0){}else{I={pxInMs:W};var M,U,Q=K-1,O=y.innerWidth();for(M=0;M<K-1;M++){U=E[M]+q.eq(F[M]).outerWidth()+N;if(U>0&&U>O-(E[M+1]+N)){Q=M;break}}if(v){L=Q}else{var H=K-1,T=Math.round(w.offset().left);for(M=0;M<K;M++){if(E[M]+T>P.pageX){H=M-1;break}}L=Q;if(Q===H&&P.timeStamp-J<1000&&S+R>Math.sqrt(Math.pow(y.height(),2)+Math.pow(O,2))*0.05){L=Math.max(0,Math.min(K-1,L+V))}}}}L=F[L];p.to(L,I)}}}());p.init();if(c){var v=false;w.bind("webkitTransitionStart",function(){v=true});w.bind("webkitTransitionEnd",function(){v=false})}function i(E){u.removeClass(f.currentClass).eq(E).addClass(f.currentClass)}function h(G,F){var E=C.current;if(E!==G){G=G!==b?G:E+1;p.to(G,{complete:F})}}function r(F,E){p.to(F-1,{dirX:+F-1,complete:E});C.current=F-1}function o(E){p.to(C.current+1,{dirX:1,complete:E})}function n(E){p.to(C.current-1,{dirX:-1,complete:E})}var d=false,z=false,j;function t(){if(z){g()}}function g(){z=true;if(!d){clearTimeout(j);j=setTimeout(function(){if(!p.moving&&!d){o()}},f.delay)}return f.container}function s(){clearTimeout(j);z=false;return f.container}u.click(function(){h(u.index(this))});a(f.prev,l).click(function(){n()});a(f.next,l).click(function(){o()});function D(){var W=a(document),N,O,R=false,J,Q,U,V,M,F,K,S,T,L,E,I=function(X){if(X.which>1){return}if(R){W.triggerHandler(A+"."+k)}R=true;O=false,N=X.timeStamp;M=L=0;J=[0,0,0,N];if(X.originalEvent.touches){W.one(x,G);return}X.preventDefault();U=V=X.pageX;S=T=X.pageY;K=w[0].offsetLeft;Q=[0,0,0,U];W.bind(m,P);W.one(A+"."+k,H);p.moveStart(X)},G=function(X){if(X.originalEvent.touches.length!==1){return}U=V=X.pageX=X.originalEvent.touches[0].pageX;S=T=X.pageY=X.originalEvent.touches[0].pageY;F=E=0;K=new WebKitCSSMatrix(window.getComputedStyle(w[0]).webkitTransform).e;Q=[0,0,0,U];W.bind(m,P);W.one(A,H);p.moveStart(X)},P=function(Z){var Y,X;if(Z.originalEvent.touches&&c){if(Z.originalEvent.touches.length!==1){return}Y=Z.pageX=Z.originalEvent.touches[0].pageX;X=Z.pageY=Z.originalEvent.touches[0].pageY;F+=Math.abs(Y-V);E+=Math.abs(X-T);if(Math.abs(F-E)>50){var aa=F;F=Math.min(100,Math.max(0,F-E));E=Math.min(100,Math.max(0,E-aa))}if(Y===V){return}if(!O){if(F>E){Z.preventDefault();O=true}else{H(Z)}}}else{Y=Z.pageX;X=Z.pageY;if(Y===V){return}if(/msie/.test(navigator.userAgent.toLowerCase())){Z.preventDefault()}}M+=Math.abs(Y-V);L+=Math.abs(X-T);J.shift();J.push(Z.timeStamp);Q.shift();Q.push(Y);p.move(Z,V);V=Y;T=X},H=function(ab){R=false;if(!ab.originalEvent||ab.originalEvent.touches){ab.pageX=V;ab.pageY=T}W.unbind(m,P);var aa=J.length,X=0,Z=0;while(--aa>0){if(J[aa-1]){var Y=Q[aa]-Q[aa-1];X+=Math.abs(Y)/(J[aa]-J[aa-1]);if(Y!==0){Z=Y>0?-1:1}}}X=X/J.length;p.moveEnd(ab,X,Z,N,M,L);v=false;if(M+L>4){y.one("click",function(ac){ac.preventDefault()})}};y.bind(x,I)}if(f.mouseTouch){D()}if(f.autoplay){g()}l.data(k,C)};a.fn.touchSlider=function(c){c=c||{};c.container=this;touchSlider(c);return this}}(jQuery));
